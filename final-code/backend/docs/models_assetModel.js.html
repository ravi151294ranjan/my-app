<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: models/assetModel.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: models/assetModel.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/**
 * AssetModel module to perform Asset operations through Asset module ..
 * @module Asset Model
 * @see {@link Assetmanage}
 */
var ObjectID = require('mongodb').ObjectID;
var crypto = require('crypto');
const IV_LENGTH = 16;

module.exports = {
    /**
       * getAlldata method used to retrive the all asset.
       * @param  {string} collectionName Its show the collection name.
       * @return {Object} Its return all asset data.
       */
    getAlldata: (collectionName, data) => {
        let db = global.db;
        return new Promise((resolve, reject) => {
            db.collection(collectionName).find().toArray((err, res) => {
                if (err) {
                    reject(err)
                }
                resolve(res)
            });
        })
    },
    /**
   * getAssetdata method used to retrive the all asset type.
   * @param  {string} collectionName Its show the collection name.
   * @return {Object} Its return all asset data.
   */
    getAssetdata: (collectionName, searchItem) => {
        let db = global.db;
        return new Promise((resolve, reject) => {
            db.collection(collectionName).find(searchItem).toArray((err, res) => {
                if (err) {
                    reject(err)
                }
                resolve(res)
            });
        })
    },
    /**
   * getAllassetViewMode method used to retrive the all asset ViewMode.
   * @param  {string} collectionName Its show the collection name.
   * @return {Object} Its return all asset data.
   */
    getAllassetViewMode: (collectionName, data) => {
        let db = global.db;
        return new Promise((resolve, reject) => {
            db.collection(collectionName).find().sort({ ViewMode: 1 }).toArray((err, res) => {
                if (err) {
                    reject(err)
                }
                resolve(res)
            });
        })
    },
    /**
   * getAllassetInventoryItemKeyName method used to retrive the all asset InventoryItemKeyName.
   * @param  {string} collectionName Its show the collection name.
   * @return {Object} Its return all asset data.
   */
    getAllassetInventoryItemKeyName: (collectionName, data) => {
        let db = global.db;
        return new Promise((resolve, reject) => {
            db.collection(collectionName).find(data).sort({ InventoryItemKeyName: 1 }).toArray((err, res) => {
                if (err) {
                    reject(err)
                }
                resolve(res)
            });
        })
    },
    /**
   * getAllassetModelDetails method used to retrive the all asset ModelDetails.
   * @param  {string} collectionName Its show the collection name.
   * @return {Object} Its return all asset data.
   */
    getAllassetModelDetails: (collectionName, data) => {
        let db = global.db;
        return new Promise((resolve, reject) => {
            db.collection(collectionName).find(data).sort({ ModelDetails: 1 }).toArray((err, res) => {
                if (err) {
                    reject(err)
                }
                resolve(res)
            });
        })
    },

    /**
* getAllScenarioListDetails method used to retrive the all asset ModelDetails.
* @param  {string} collectionName Its show the collection name.
* @return {Object} Its return all asset data.
*/
    getAllScenarioListDetails: (collectionName) => {
        let db = global.db;
        return new Promise((resolve, reject) => {
            db.collection(collectionName).find({}).toArray((err, res) => {
                if (err) {
                    reject(err)
                }
                resolve(res)
            });
        })
    },





    /**
       * CreateAsset method used to create asset in db.
       * @param  {string} collectionName Its show the collection name.
       * @param  {string} data Its contain the asset data for insertion.
       * @return {Object} Its return success or failure message based on insertion.
       */

    CreateAsset: (collectionName, data) => {
        let db = global.db;
        return new Promise((resolve, reject) => {
            var data_History = data
            db.collection(collectionName).insertOne(data, (err, dataval) => {
                if (err) { reject(err) }
                else {
                    var dataenc = dataval.ops[0]._id
                    if (err) { reject(err) }
                    encryptData()
                    function encryptData() {
                        var encrypted = encrypt(dataenc.toString())
                        const dataCheck = (encrypted.toString()).includes('/');
                        if (dataCheck) {
                            encryptData()
                        } else {
                            let updateData = {
                                asset_Thumpnail_encrypt: process.env.baseUrl + 'uploadImg/getthumbnailData/' + dataval.ops[0]._id,
                                asset_bundel_encrypt: process.env.baseUrl + 'uploadImg/getbundelData/' + dataval.ops[0]._id,
                                asset_manifest_encrypt: process.env.baseUrl + 'uploadImg/getmanifestData/' + dataval.ops[0]._id,
                                asset_encrypt: encrypted,
                                assetViewer: 'http://localhost:4200/#/pages/assetviewer/' + dataval.ops[0]._id
                                // assetViewer:process.env.baseUrl+'#/pages/assetviewer/'+ dataval.ops[0]._id
                            }
                            db.collection(collectionName).updateMany({ _id: ObjectID(dataval.ops[0]._id) }, {
                                $set: updateData
                            }, {
                                safe: true
                            }, (err, res) => {
                                if (err) {
                                    reject(err)
                                }
                                if (data.modeDetails !== 'Web') {
                                    db.collection(collectionName).updateMany({ _id: ObjectID(dataval.ops[0]._id) }, {
                                        $set: {
                                            'VR.0.asset_Thumpnail_encrypt': process.env.baseUrl + 'uploadImg/getthumbnailData/' + dataval.ops[0]._id + '/VR',
                                            'VR.0.asset_bundel_encrypt': process.env.baseUrl + 'uploadImg/getbundelData/' + dataval.ops[0]._id + '/VR',
                                            'VR.0.asset_manifest_encrypt': process.env.baseUrl + 'uploadImg/getmanifestData/' + dataval.ops[0]._id + '/VR',
                                            'VR.0.asset_encrypt': encrypted
                                        }
                                    }, (err, val) => {
                                        if (err) {
                                            reject(err)
                                        }

                                        db.collection(collectionName).find({ _id: ObjectID(dataval.ops[0]._id) }).toArray((err, res) => {
                                            if (err) { reject(err) }
                                            var historydataValue = res[0]
                                            historydataValue['assetId'] = dataval.ops[0]._id
                                            db.collection('assestdetails_History').insertOne(historydataValue, (err, historydata) => {
                                                if (err) { reject(err) }
                                                let result = {
                                                    success: true,
                                                    status: 200,
                                                    message: "Asset created successful!",
                                                    dataValue: dataval.ops
                                                }
                                                resolve(result)
                                            })
                                        })
                                    })
                                } else {


                                    db.collection(collectionName).find({ _id: ObjectID(dataval.ops[0]._id) }).toArray((err, res) => {
                                        if (err) { reject(err) }
                                        var historydataValue = res[0]
                                        historydataValue['assetId'] = dataval.ops[0]._id
                                        db.collection('assestdetails_History').insertOne(historydataValue, (err, historydata) => {
                                            if (err) { reject(err) }
                                            let result = {
                                                success: true,
                                                status: 200,
                                                message: "Asset created successful!",
                                                dataValue: dataval.ops
                                            }
                                            resolve(result)
                                        })
                                    })


                                }
                            })
                        }
                    }
                }
            })
        })
    },
    /**
       * getSingleAsset method used to retrive the all asset.
       * @param  {string} collectionName Its show the collection name.
       * @param  {string} id Its contain specific asset id.
       * @return {Object} Its return specific asset data.
       */
    getSingleAsset: (collectionName, id) => {
        let db = global.db;
        return new Promise((resolve, reject) => {
            db.collection(collectionName).find({ _id: ObjectID(id) }).toArray((err, res) => {
                if (err) { reject(err) }
                if (res.length == 0) {
                    let result = [{
                        message: "Asset not found.",
                        success: false,
                        status: 404
                    }]
                    resolve(result)
                } else {
                    res[0].success = true
                    res[0].status = 200
                    resolve(res)
                }
            })
        })
    },
    /**
       * updateasset method used to update the specific asset.
       * @param  {string} collectionName Its show the collection name.
       * @param  {string} data Its contain specific asset data.
       * @param  {string} id Its contain specific asset id.
       * @return {Object} Its return success or failure message.
       */

    updateasset: (collectionName, data, id) => {

        let db = global.db;
        return new Promise((resolve, reject) => {
            db.collection(collectionName).updateMany({ _id: ObjectID(id) }, {
                $set: data
            }, {
                safe: true
            }, (err, res) => {
                if (err) {
                    reject(err)
                }

                let historydataValue = data
                historydataValue['assetId'] = ObjectID(id)
                db.collection('assestdetails_History').insertOne(historydataValue, (err, historydata) => {

                    if (err) {
                        reject(err)
                    }

                    let result = {
                        success: true,
                        status: 200,
                        message: "Asset update successful!"
                    }
                    resolve(result)
                })
            })
        })
    },

    createCategory: (collectionName, data) => {
        let db = global.db;
        return new Promise((resolve, reject) => {
            // db.collection(collectionName).find({type:data.type}).toArray((err, categorydata) => {
                // if (err) {
                //     reject(err)
                // }
                // if (categorydata.length &lt;= 10) {
                    // console.log(data)
                    db.collection(collectionName).find({ category: data.category,type:data.type }).toArray((err, category) => {
                        if (err) { reject(err) }
                        console.log(category)
                        if (category.length == 0) {
                            db.collection(collectionName).insertOne(data, (err, catdata) => {
                                if (err) {
                                    reject(err)
                                }
                                let result = {
                                    message: 'Category created successfully.',
                                    status: 200,
                                    success: true
                                }
                                resolve(result)
                            })
                        } else {
                            let result = {
                                message: 'Category already created.',
                                status: 402,
                                success: false
                            }
                            resolve(result)
                        }
                    })
                // } else {
                //     let result = {
                //         message: 'Category limit exits.',
                //         status: 402,
                //         success: false
                //     }
                //     resolve(result)
                // }
            // })
        })
    }




}


function encrypt(text) {
    const iv = crypto.randomBytes(16);
    const cipher = crypto.createCipheriv(process.env.cryptoalgorithm, process.env.secretKey, iv);
    const encrypted = Buffer.concat([cipher.update(text), cipher.final()]);
    var enc = iv.toString('hex') + "_" + encrypted.toString('hex');
    console.log(iv.toString('hex') + "_" + encrypted.toString('hex'));
    return enc;

}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-AdminDetails.html">AdminDetails</a></li><li><a href="module-Appconfig.html">Appconfig</a></li><li><a href="module-Asset%2520Model.html">Asset Model</a></li><li><a href="module-Assetmanage.html">Assetmanage</a></li><li><a href="module-AuthMiddleware.html">AuthMiddleware</a></li><li><a href="module-dashboard.html">dashboard</a></li><li><a href="module-DB%2520Connection.html">DB Connection</a></li><li><a href="module-ErrorLog.html">ErrorLog</a></li><li><a href="module-forgot%2520Model.html">forgot Model</a></li><li><a href="module-forgotPwd.html">forgotPwd</a></li><li><a href="module-Group.html">Group</a></li><li><a href="module-Group%2520Model.html">Group Model</a></li><li><a href="module-Register.html">Register</a></li><li><a href="module-Report.html">Report</a></li><li><a href="module-Report%2520Model.html">Report Model</a></li><li><a href="module-Scenario.html">Scenario</a></li><li><a href="module-Scenario%2520Model.html">Scenario Model</a></li><li><a href="module-ScenarioUser.html">ScenarioUser</a></li><li><a href="module-sendEmail%2520Model.html">sendEmail Model</a></li><li><a href="module-ShorturlGet.html">ShorturlGet</a></li><li><a href="module-SuperAdmin.html">SuperAdmin</a></li><li><a href="module-TenantDetails.html">TenantDetails</a></li><li><a href="module-TokenGenration.html">TokenGenration</a></li><li><a href="module-Upload.html">Upload</a></li><li><a href="module-URLShortner.html">URLShortner</a></li><li><a href="module-User.html">User</a></li><li><a href="module-User%252520Model.html">User Model</a></li><li><a href="module-WEBGL%2520Model.html">WEBGL Model</a></li></ul><h3>Global</h3><ul><li><a href="global.html#getAllAssetForUnity">getAllAssetForUnity</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Wed Jun 02 2021 15:41:57 GMT+0530 (India Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
